<main class="app-wrapper">
  <div class="container-fluid">
    <div class="app-page-head d-flex align-items-center justify-content-between">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item">
            <a routerLink="/">
              <i class="fi fi-rr-home"></i> Inicio
            </a>
          </li>
          <li class="breadcrumb-item active2" aria-current="page">Listado de Inspecciones</li>
        </ol>
      </nav>
      <div class="d-none d-lg-flex gap-2">
        <div class="search-box position-relative">
          <input type="text" class="form-control ps-5" placeholder="Buscar inspecciones..." [(ngModel)]="searchTerm"
            (input)="onSearch()">
          <i class="fi fi-rr-search position-absolute" style="left: 15px; top: 50%; transform: translateY(-50%);"></i>
        </div>
        <div class="d-flex align-items-center gap-2 position-relative">
          <input type="checkbox" id="inspections-fab-check" class="fab-check">
          <label class="btn btn-primary waves-effect waves-light" for="inspections-fab-check">
            <i class="fi fi-rr-plus me-1"></i> Nueva Inspección
          </label>
          <div class="fab-options d-flex flex-column"
            style="bottom: auto; top: 100%; right: 0; left: auto; transform-origin: top right; z-index: 1050;">
            <a routerLink="/busetas" class="fab-option" (click)="$event.stopPropagation()">
              <span class="fab-label">Busetas</span>
              <span class="fab-option-icon">1</span>
            </a>
            <a routerLink="/nueva" class="fab-option" (click)="$event.stopPropagation()">
              <span class="fab-label">Camioneta</span>
              <span class="fab-option-icon">2</span>
            </a>
            <a (click)="pending()" class="fab-option" (click)="$event.stopPropagation()">
              <span class="fab-label text-warning">Pesados</span>
              <span class="fab-option-icon">3</span>
            </a>
          </div>
        </div>
      </div>
      <div class="d-block d-lg-none">
        <!-- Aquí podrías añadir un botón de menú móvil si es necesario -->
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header d-flex align-items-center justify-content-between">
            <h5 class="mb-0">Inspecciones</h5>
            <div class="text-muted">
              Total: {{ totalInspections }} | Este mes: {{ currentMonthInspections }}
            </div>
          </div>
          <div class="card-body px-1 pt-2 pb-2">
            <div class="table-responsive">
              <table id="dt_Inspections" class="table table-sm display table-row-rounded data-row-checkbox">
                <thead class="table-light">
                  <tr>
                    <th class="pe-0">
                      <div class="form-check">
                        <input class="form-check-input" data-row-checkbox type="checkbox">
                      </div>
                    </th>
                    <th class="minw-200px">Conductor</th>
                    <th class="minw-150px">Placa del vehículo</th>
                    <th class="minw-150px">Teléfono</th>
                    <th class="minw-125px">Fecha</th>
                    <th>Status</th>
                    <th>Acción</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let inspection of filteredInspections" (click)="viewInspection(inspection.id)"
                    style="cursor: pointer;">
                    <td class="pe-0">
                      <div class="form-check p-0 w-auto d-inline-block mb-0 mb-n1">
                        <input class="form-check-input m-0" data-checkbox type="checkbox"
                          (click)="$event.stopPropagation()">
                      </div>
                    </td>
                    <td>
                      <div class="d-flex align-items-center">
                        <div class="avatar avatar-circle avatar-xs me-2">
                          <i class="fi fi-rr-user"></i>
                        </div>
                        <span class="fw-semibold">{{ inspection.nombres_conductor || 'N/A' }}</span>
                      </div>
                    </td>
                    <td>
                      <span class="">{{ inspection.placa || 'N/A' }}</span>
                    </td>
                    <td>
                      <span class="text-muted">{{ inspection.telefono || 'N/A' }}</span>
                    </td>
                    <td>
                      <span class="text-muted">{{ inspection.fecha_inspeccion ? (inspection.fecha_inspeccion |
                        date:'dd/MM/yyyy') : 'N/A' }}</span>
                    </td>
                    <td>
                      <span class="badge" [ngClass]="{
                            'bg-success': inspection.status === 'approved',
                            'bg-warning': inspection.status === 'rejected',
                            'bg-soft-primary': !['approved', 'rejected'].includes(inspection.status || '')
                          }">
                        {{ inspection.status || 'N/A' }}
                      </span>
                    </td>
                    <td class="text-center">
                      <div class="d-flex gap-2 justify-content-center">
                        <button class="btn btn-sm btn-icon btn-soft-primary"
                          (click)="$event.stopPropagation(); viewInspection(inspection.id)" title="Ver">
                          <i class="fi fi-rr-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-icon btn-soft-info" (click)="$event.stopPropagation();"
                          title="Editar">
                          <i class="fi fi-rr-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-icon btn-soft-danger"
                          (click)="deleteInspection($event, inspection.id)" title="Eliminar">
                          <i class="fi fi-rr-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                  <tr *ngIf="filteredInspections.length === 0">
                    <td colspan="9" class="text-center py-4">
                      <div class="d-flex flex-column align-items-center">
                        <i class="fi fi-rr-search-alt text-muted mb-2" style="font-size: 2rem;"></i>
                        <p class="mb-0">No se encontraron inspecciones</p>
                        <small class="text-muted">Intenta con otros términos de búsqueda</small>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
    <!-- Floating Action Button for Mobile/Tablet -->
  <div class="floating-action d-lg-none">
    <input type="checkbox" id="fab-check" class="fab-check">
    <label class="fab" for="fab-check">
      <span class="fab-icon">+</span>
      <span class="fab-icon-close">×</span>
    </label>
    <div class="fab-options">

      <a routerLink="/busetas" class="fab-option">
        <span class="fab-label ">Busetas</span>
        <span class="fab-option-icon ">1</span>
      </a>
      <a routerLink="/nueva" class="fab-option">
        <span class="fab-label">Camioneta</span>
        <span class="fab-option-icon">2</span>
      </a>
      <a (click)="pending()" class="fab-option">
        <span class="fab-label text-warning">Pesados</span>
        <span class="fab-option-icon">3</span>
      </a>
    </div>
  </div>

  <style>
    .floating-action {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      z-index: 1000;
    }

    .fab {
      width: 56px;
      height: 56px;
      background-color: var(--bs-primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 2rem;
      font-weight: 300;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      user-select: none;
      position: relative;
    }

    .fab:hover {
      background-color: var(--bs-primary);
      transform: scale(1.1);
    }

    .fab-icon-close {
      position: absolute;
      opacity: 0;
      transform: rotate(-45deg);
      transition: all 0.3s ease;
    }

    .fab-check:checked+.fab .fab-icon {
      opacity: 0;
      transform: rotate(45deg);
    }

    .fab-check:checked+.fab .fab-icon-close {
      opacity: 1;
      transform: rotate(0);
    }

    .fab-check:checked+.fab {
      background-color: var(--bs-primary);
    }

    .fab-check:checked+.fab:hover {
      background-color: var(--bs-primary);
    }

    .fab-check {
      display: none;
    }

    .fab-options {
      position: absolute;
      bottom: 70px;
      right: 0;
      opacity: 0;
      transform: scale(0);
      transform-origin: bottom right;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .fab-check:checked~.fab-options {
      opacity: 1;
      transform: scale(1);
    }

    .fab-option {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      text-decoration: none;
      color: #333;
    }

    .fab-label {
      background: white;
      padding: 8px 12px;
      border-radius: 20px;
      margin-right: 10px;
      font-size: 0.85rem;
      white-space: nowrap;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .fab-option-icon {
      width: 40px;
      height: 40px;
      background-color: var(--bs-primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    @media (min-width: 992px) {
      .floating-action {
        display: none;
      }
    }
  </style>
</main>
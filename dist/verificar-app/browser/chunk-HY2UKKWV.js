import{f as n}from"./chunk-SL65TR4P.js";import{L as a,P as i,Zb as c}from"./chunk-QCVMPDFW.js";var l=class s{constructor(e){this.router=e;this.pb.authStore.loadFromCookie(document.cookie)}pb=new c("https://db.buckapi.site:8095");async login(e,r){try{let o=await this.pb.collection("users").authWithPassword(e,r);return document.cookie=`${this.pb.authStore.exportToCookie({httpOnly:!1})}; path=/; max-age=604800; SameSite=Lax`,o.record}catch(o){throw console.error("Error en login:",o),new Error(o?.response?.message||"Error al iniciar sesi\xF3n")}}logout(){this.pb.authStore.clear(),document.cookie="pb_auth=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",this.router.navigate(["/login"])}isAuthenticated(){return this.pb.authStore.isValid}getToken(){return this.pb.authStore.token}getCurrentUser(){return this.pb.authStore.model}getCurrentUserId(){return this.pb.authStore.model?.id||null}redirectToDashboard(e){e.role==="admin"?this.router.navigate(["/admin"]):this.router.navigate(["/home"])}async register(e){try{return await this.pb.collection("users").create(e)}catch(r){throw console.error("Error en registro:",r),new Error(r?.response?.message||"Error al registrar usuario")}}async updateProfile(e){if(!this.pb.authStore.model)throw new Error("No hay usuario autenticado");try{return await this.pb.collection("users").update(this.pb.authStore.model.id,e)}catch(r){throw console.error("Error actualizando perfil:",r),new Error(r?.response?.message||"Error al actualizar perfil")}}async changePassword(e,r,o){try{await this.pb.collection("users").update(this.pb.authStore.model.id,{oldPassword:e,newPassword:r,newPasswordConfirm:o})}catch(t){throw console.error("Error cambiando contrase\xF1a:",t),new Error(t?.response?.message||"Error al cambiar contrase\xF1a")}}async requestPasswordReset(e){try{await this.pb.collection("users").requestPasswordReset(e)}catch(r){throw console.error("Error solicitando recuperaci\xF3n:",r),new Error(r?.response?.message||"Error al solicitar recuperaci\xF3n")}}async confirmPasswordReset(e,r,o){try{await this.pb.collection("users").confirmPasswordReset(e,r,o)}catch(t){throw console.error("Error confirmando recuperaci\xF3n:",t),new Error(t?.response?.message||"Error al confirmar recuperaci\xF3n")}}static \u0275fac=function(r){return new(r||s)(i(n))};static \u0275prov=a({token:s,factory:s.\u0275fac,providedIn:"root"})};export{l as a};
